(function () {var c={};function h(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function d(e,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,o,t){return o&&d(e.prototype,o),t&&d(e,t),e}function e(e){new t(e)}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e,t,s){return t&&f(e.prototype,t),s&&f(e,s),e}var l=function(){function e(t,s){j(this,e),this.url=t,this.onMessage=s,this.open=!1,this.actions=[],this.socket=new WebSocket(this.url),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onmessage=this.onMessage}return k(e,[{key:"onOpen",value:function(){for(this.open=!0;this.actions.length;){var e=this.actions.pop();this.send(e)}}},{key:"onClose",value:function(){this.socket=void 0,this.open=!1}},{key:"onMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(s){t=e.data}this.onMessage(t)}},{key:"send",value:function(e){this.open?this.socket.send(JSON.stringify(e)):this.actions.push(e)}}]),e}();function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,o,r){return{required:e,type:o,fallback:r}}function p(e,o){if(void 0===e)throw new Error("You need to supply an options object");var r,t={};for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&void 0===o[r])throw new Error("Unrecognized option "+r);for(r in o)if(Object.prototype.hasOwnProperty.call(o,r)){var n=o[r],u=e[r];if(void 0===u){if(n.required)throw new Error("Value "+r+" must be defined and of type "+n.type);t[r]=n.default}else{if(m(u)!==n.type)throw new Error("Value "+r+" must be of type "+n.type);t[r]=u}}return t}function q(e){if(!document.querySelector(e))throw new Error("No element found with id "+e);return e}function n(e){return document.querySelector(e).value}function r(e){var t=document.createElement("style");t.appendChild(document.createTextNode("")),document.head.appendChild(t);var n=t.sheet;e.forEach(function(e){n.inserRule(e,n.cssRules.length)})}function s(e,t){document.querySelector(e).onkeyup=function(e){13===(e.which||e.keyCode)&&t()}}function u(r){var e=r.match(/^#?([0-9a-f]{6})$/i);if(e)return("#"+e[1]).toLowerCase();if(e=r.match(/^#?([1-9a-f])([1-9a-f])([1-9a-f])$/i))return("#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]).toLowerCase();var t="[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]",$=new RegExp("^rgb\\(("+t+"), ?("+t+"), ?("+t+")\\)$");if(e=r.match($))return("#"+b(e[1])+b(e[2])+b(e[3])).toLowerCase();throw new Error("Unrecognized color "+r+". Must be either hex or rgb format")}function g(r,e){r=r.slice(1);var t=30;e||(t*=-1);var $=parseInt(r,16);return"#"+b(($>>16)+t)+b(($>>8&255)+t)+b((255&$)+t)}function b(r){(r=parseInt(r))>255&&(r=255),r<0&&(r=0);var e=r.toString(16);return 1===e.length&&(e="0"+e),e}function o(t){return 0===Object.keys(t).length}c.init=e;var t=function(){function e(o){h(this,e);var t=this,n={url:a(!0,"string"),email:a(!0,"string"),onMessage:a(!0,"function"),submitOnEnter:a(!1,"boolean",!1),whatsThis:a(!1,"boolean",!1),color:a(!1,"string","#2f81c6"),extra:a(!1,"object",{})};t.opts=p(o,n),q(t.opts.email),t.opts.color=u(t.opts.color),t.socket=new l(t.opts.url,function(e){t.enableButton(),t.opts.onMessage(e)}),t.buildButton(),t.opts.submitOnEnter&&s(t.opts.email,t.unlock)}return i(e,[{key:"unlock",value:function(){this.disableButton();var e={type:"Unlock",email:this.email};o(this.opts.extra)||(e.extra=this.opts.extra),this.socket.send(e)}},{key:"enableButton",value:function(){var e=document.querySelector("#unlock-button").querySelector("#_unlock-button");e.removeEventListener("click",this.unlock),e.addEventListener("click",this.unlock),e.classList.remove("unlock-disabled"),e.classList.add("unlock-enabled")}},{key:"disableButton",value:function(){var e=document.querySelector("#unlock-button").querySelector("#_unlock-button");e.removeEventListener("click",this.unlock),e.classList.remove("unlock-enabled"),e.classList.add("unlock-disabled")}},{key:"buildButton",value:function(){var e=document.querySelector("#unlock-button");if(e.querySelector("#_unlock-button")){var o=e.cloneNode(!0);e.parentNode.replaceChild(o,e)}else{var t="<div id=\"_unlock-button\" class=\"unlock-enabled\"><img id=\"_unlock-logo\" src=\"https://www.unlock-app.com/images/unlock-logo-text.svg\"><span id=\"_unlock-cover\"></span><div id=\"_unlock-spinner\"><div id=\"_unlock-dot-one\" class=\"unlock-dot\"></div><div id=\"_unlock-dot-two\" class=\"unlock-dot\"></div><div id=\"_unlock-dot-three\" class=\"unlock-dot\"></div></div></div>";this.opts.whatsThis&&(t+="<div id=\"_unlock-link\"><a href=\"https://www.unlock-app.com\" target=\"_blank\">What's this?</a></div>"),e.innerHTML=t}this.addColor(),this.enableButton()}},{key:"addColor",value:function(){var e=self.opts.color,o=g(e,!0),t=g(e,!1),n=["#unlock-button #_unlock-button {background-color: ".concat(e,"}"),"#unlock-button #_unlock-button.unlock-enabled:hover {background-color: ".concat(o,"}"),"#unlock-button #_unlock-button.unlock-enabled:active {background-color: ".concat(t,"}")];this.opts.whatsThis&&n.push("#unlock-button #_unlock-link a {color: ".concat(e,"}")),r(n)}},{key:"email",get:function(){return n(this.email)}}]),e}();if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=c}else if(typeof define==="function"&&define.amd){define(function(){return c})}else{this["Unlock"]=c}})();