!function(){function e(e){var o=this;e=function(e,o){if(void 0===e)throw new Error("You need to supply an options object");var t,n={};for(t in e)if(e.hasOwnProperty(t)&&void 0===o[t])throw new Error("Unrecognized option "+t);for(t in o)if(o.hasOwnProperty(t)){var r=o[t],u=e[t];if(void 0===u){if(r.required)throw new Error("Value "+t+" must be defined and of type "+r.type);n[t]=r.default}else{if(typeof u!==r.type)throw new Error("Value "+t+" must be of type "+r.type);n[t]=u}}return n}(e,{url:{required:!0,type:"string"},email:{required:!0,type:"string"},onMessage:{required:!0,type:"function"},button:{required:!1,type:"boolean",default:!0},buttonId:{required:!1,type:"string",default:"#unlock-button"},color:{required:!1,type:"string",default:"#2f81c6"},onOpen:{required:!1,type:"function",default:function(){}},onClose:{required:!1,type:"function",default:function(){}}}),o.url=e.url,o.email=t(e.email),o.button=e.button,o.buttonId=t(e.buttonId),o.color=function(e){var o=e.match(/^#?([0-9a-f]{6})$/i);if(o)return("#"+o[1]).toLowerCase();if(o=e.match(/^#?([1-9a-f])([1-9a-f])([1-9a-f])$/i))return("#"+o[1]+o[1]+o[2]+o[2]+o[3]+o[3]).toLowerCase();var t="[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]",n=new RegExp("^rgb\\(("+t+"), ?("+t+"), ?("+t+")\\)$");if(o=e.match(n))return("#"+r(o[1])+r(o[2])+r(o[3])).toLowerCase();throw new Error("Unrecognized color "+e+". Must be either hex or rgb format")}(e.color),o.onMessage=e.onMessage,o.onOpen=e.onOpen,o.onClose=e.onClose,o.socket=new WebSocket(o.url),o.open=!1,o.shouldSend=!1,o._setupSocket(),o.button&&(o.onclick=o._submit.bind(o),o._buildButton())}function t(e){if(!document.querySelector(e))throw new Error("No element found with id "+e);return e}function i(e,o){e=e.slice(1);var t=30;o||(t*=-1);var n=parseInt(e,16);return"#"+r((n>>16)+t)+r((n>>8&255)+t)+r((255&n)+t)}function r(e){255<(e=parseInt(e))&&(e=255),e<0&&(e=0);var o=e.toString(16);return 1===o.length&&(o="0"+o),o}e.prototype.unlock=function(){this.socket.send(JSON.stringify({type:"unlock",email:this._getEmail()}))},e.prototype.isOpen=function(){return this.open},e.prototype.enableButton=function(){var e=this;if(e.button){var o=document.querySelector(e.buttonId);o.removeEventListener("click",e.onclick),o.addEventListener("click",e.onclick),o.classList.remove("unlock-disabled"),o.classList.add("unlock-enabled")}},e.prototype.disableButton=function(){var e=this;if(e.button){var o=document.querySelector(e.buttonId);o.removeEventListener("click",e.onclick),o.classList.remove("unlock-enabled"),o.classList.add("unlock-disabled")}},e.prototype._setupSocket=function(){var e=this;e.socket.onopen=function(){e.open=!0,e.shouldSend&&(e.unlock(),e.shouldSend=!1),e.onOpen()},e.socket.onclose=function(){e.socket=void 0,e.open=!1,e.onClose()},e.socket.onmessage=function(o){var t;try{t=JSON.parse(o.data)}catch(e){t=o.data}e.button&&e.enableButton(),e.onMessage(t)},e.socket.onerror=function(e){throw e}},e.prototype._getEmail=function(){return document.querySelector(this.email).value},e.prototype._submit=function(){var e=this;e.open?(e.disableButton(),e.unlock()):e.shouldSend=!0},e.prototype._buildButton=function(){var e=this,o=document.querySelector(e.buttonId);if(o.querySelector("#unlock-logo")){var t=o.cloneNode(!0);o.parentNode.replaceChild(t,o)}else{o.classList.add("unlock-enabled");o.innerHTML='<img id="unlock-logo" src="https://www.unlock-auth.com/images/unlock-logo-text.svg"><span id="unlock-cover"></span><div id="unlock-spinner"><div class="unlock-dot" id="unlock-dot-one"></div><div class="unlock-dot" id="unlock-dot-two"></div><div class="unlock-dot" id="unlock-dot-three"></div></div>'}e._addColor(),e.enableButton()},e.prototype._addColor=function(){var e=this,o=e.color,t=i(e.color,!0),n=i(e.color,!1),r=document.createElement("style");r.appendChild(document.createTextNode("")),document.head.appendChild(r);var u=r.sheet;u.insertRule(e.buttonId+" {background-color: "+o+"}",u.cssRules.length),u.insertRule(e.buttonId+".unlock-enabled:hover {background-color: "+t+"}",u.cssRules.length),u.insertRule(e.buttonId+".unlock-enabled:active {background-color: "+n+"}",u.cssRules.length)},window.Unlock=e}();