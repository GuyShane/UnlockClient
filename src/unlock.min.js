!function(){function e(e){var t=this;e=function(e,t){var o,n={};for(o in e)if(e.hasOwnProperty(o)&&void 0===t[o])throw new Error("Unrecognized option "+o);for(o in t)if(t.hasOwnProperty(o)){var u=t[o],i=e[o];if(void 0===i){if(u.required)throw new Error("Value "+o+" must be defined and of type "+u.type);n[o]=u.default}else{if(typeof i!==u.type)throw new Error("Value "+o+" must be of type "+u.type);n[o]=i}}return n}(e,{url:{required:!0,type:"string"},email:{required:!0,type:"string"},onMessage:{required:!0,type:"function"},button:{required:!1,type:"boolean",default:!0},color:{required:!1,type:"string",default:"#2f81c6"},onOpen:{required:!1,type:"function",default:function(){}},onClose:{required:!1,type:"function",default:function(){}}}),t.url=e.url,t.email=e.email,t.button=e.button,t.color=e.color,t.onMessage=e.onMessage,t.onOpen=e.onOpen,t.onClose=e.onClose,t.socket=new WebSocket(t.url),t.isOpen=!1,t.shouldSend=!1,t.setupSocket(),t.button&&(t.buttonId="unlock-button",t.onclick=t.submit.bind(t),t.buildButton())}function l(e,t){e=e.slice(1);var o=30;t||(o*=-1);var n=parseInt(e,16);return"#"+u((n>>16)+o)+u((n>>8&255)+o)+u((255&n)+o)}function u(e){255<e&&(e=255),e<0&&(e=0);var t=e.toString(16);return 1===t.length&&(t="0"+t),t}e.prototype.unlock=function(){this.socket.send(JSON.stringify({type:"unlock",email:this.getEmail()}))},e.prototype.setupSocket=function(){var e=this;e.socket.onopen=function(){e.onOpen(),e.isOpen=!0,e.shouldSend&&(e.unlock(),e.shouldSend=!1)},e.socket.onclose=function(){e.onClose(),e.socket=void 0,e.isOpen=!1},e.socket.onmessage=function(t){var o;try{o=JSON.parse(t.data)}catch(e){o=t}e.button&&e.enableButton(),e.onMessage(o)}},e.prototype.getEmail=function(){return document.getElementById(this.email).value},e.prototype.submit=function(){var e=this;e.isOpen?(e.disableButton(),e.unlock()):e.shouldSend=!0},e.prototype.enableButton=function(){var e=this;if(e.button){var t=document.getElementById(e.buttonId);t.removeEventListener("click",e.onclick),t.addEventListener("click",e.onclick),t.classList.remove("unlock-disabled"),t.classList.add("unlock-enabled")}},e.prototype.disableButton=function(){var e=this;if(e.button){var t=document.getElementById(e.buttonId);t.removeEventListener("click",e.onclick),t.classList.remove("unlock-enabled"),t.classList.add("unlock-disabled")}},e.prototype.buildButton=function(){var e=this,t=document.getElementById(e.buttonId);t.classList.add("unlock-enabled");t.innerHTML='<img id="unlock-logo" src="https://www.unlock-auth.com/images/unlock-logo-text.svg"><span id="unlock-cover"></span><div id="unlock-spinner"><div class="unlock-dot" id="unlock-dot-one"></div><div class="unlock-dot" id="unlock-dot-two"></div><div class="unlock-dot" id="unlock-dot-three"></div></div>',e.addColor(),e.enableButton()},e.prototype.addColor=function(){var e=this,t=e.color,o=l(e.color,!0),n=l(e.color,!1),u=document.createElement("style");u.appendChild(document.createTextNode("")),document.head.appendChild(u);var i=u.sheet;i.insertRule("#unlock-button {background-color: "+t+"}",i.cssRules.length),i.insertRule("#unlock-button.unlock-enabled:hover {background-color: "+o+"}",i.cssRules.length),i.insertRule("#unlock-button.unlock-enabled:active {background-color: "+n+"}",i.cssRules.length)},window.Unlock=e}();