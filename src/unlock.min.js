!function(){function e(e){var t=this;e=function(e,t){var n,o={};for(n in e)if(e.hasOwnProperty(n)&&void 0===t[n])throw new Error("Unrecognized option "+n);for(n in t)if(t.hasOwnProperty(n)){var r=t[n],i=e[n];if(void 0===i){if(r.required)throw new Error("Value "+n+" must be defined and of type "+r.type);o[n]=r.default}else{if(typeof i!==r.type)throw new Error("Value "+n+" must be of type "+r.type);o[n]=i}}return o}(e,{url:{required:!0,type:"string"},email:{required:!0,type:"string"},onMessage:{required:!0,type:"function"},button:{required:!1,type:"boolean",default:!0},color:{required:!1,type:"string",default:"#2f81c6"},onOpen:{required:!1,type:"function",default:function(){}},onClose:{required:!1,type:"function",default:function(){}}}),t.url=e.url,t.email=e.email,t.button=e.button,t.color=function(e){var t=e.match(/^#?([0-9a-f]{6})$/i);if(t)return"#"+t[1];if(t=e.match(/^#?([1-9a-f])([1-9a-f])([1-9a-f])$/i))return"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3];var n="[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]",o=new RegExp("^rgb\\(("+n+"), ?("+n+"), ?("+n+")\\)$","i");if(t=e.match(o))return"#"+parseInt(t[1]).toString(16)+parseInt(t[2]).toString(16)+parseInt(t[3]).toString(16);throw new Error("Unrecognized color "+e+". Must be either hex or rgb format")}(e.color),t.onMessage=e.onMessage,t.onOpen=e.onOpen,t.onClose=e.onClose,t.socket=new WebSocket(t.url),t.isOpen=!1,t.shouldSend=!1,t._setupSocket(),t.button&&(t.buttonId="unlock-button",t.onclick=t._submit.bind(t),t._buildButton())}function u(e,t){e=e.slice(1);var n=30;t||(n*=-1);var o=parseInt(e,16);return"#"+r((o>>16)+n)+r((o>>8&255)+n)+r((255&o)+n)}function r(e){255<e&&(e=255),e<0&&(e=0);var t=e.toString(16);return 1===t.length&&(t="0"+t),t}e.prototype.unlock=function(){this.socket.send(JSON.stringify({type:"unlock",email:this._getEmail()}))},e.prototype.isOpen=function(){return this.isOpen},e.prototype.enableButton=function(){var e=this;if(e.button){var t=document.getElementById(e.buttonId);t.removeEventListener("click",e.onclick),t.addEventListener("click",e.onclick),t.classList.remove("unlock-disabled"),t.classList.add("unlock-enabled")}},e.prototype.disableButton=function(){var e=this;if(e.button){var t=document.getElementById(e.buttonId);t.removeEventListener("click",e.onclick),t.classList.remove("unlock-enabled"),t.classList.add("unlock-disabled")}},e.prototype._setupSocket=function(){var e=this;e.socket.onopen=function(){e.onOpen(),e.isOpen=!0,e.shouldSend&&(e.unlock(),e.shouldSend=!1)},e.socket.onclose=function(){e.onClose(),e.socket=void 0,e.isOpen=!1},e.socket.onmessage=function(t){var n;try{n=JSON.parse(t.data)}catch(e){n=t}e.button&&e.enableButton(),e.onMessage(n)}},e.prototype._getEmail=function(){return document.getElementById(this.email).value},e.prototype._submit=function(){var e=this;e.isOpen?(e.disableButton(),e.unlock()):e.shouldSend=!0},e.prototype._buildButton=function(){var e=this,t=document.getElementById(e.buttonId);t.classList.add("unlock-enabled");t.innerHTML='<img id="unlock-logo" src="https://www.unlock-auth.com/images/unlock-logo-text.svg"><span id="unlock-cover"></span><div id="unlock-spinner"><div class="unlock-dot" id="unlock-dot-one"></div><div class="unlock-dot" id="unlock-dot-two"></div><div class="unlock-dot" id="unlock-dot-three"></div></div>',e._addColor(),e.enableButton()},e.prototype._addColor=function(){var e=this,t=e.color,n=u(e.color,!0),o=u(e.color,!1),r=document.createElement("style");r.appendChild(document.createTextNode("")),document.head.appendChild(r);var i=r.sheet;i.insertRule("#unlock-button {background-color: "+t+"}",i.cssRules.length),i.insertRule("#unlock-button.unlock-enabled:hover {background-color: "+n+"}",i.cssRules.length),i.insertRule("#unlock-button.unlock-enabled:active {background-color: "+o+"}",i.cssRules.length)},window.Unlock=e}();