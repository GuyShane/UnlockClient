!function(){function e(e){var o=this;e=function(e,o){var t,n={};for(t in e)if(e.hasOwnProperty(t)&&void 0===o[t])throw new Error("Unrecognized option "+t);for(t in o)if(o.hasOwnProperty(t)){var u=o[t],i=e[t];if(void 0===i){if(u.required)throw new Error("Value "+t+" must be defined and of type "+u.type);n[t]=u.default}else{if(typeof i!==u.type)throw new Error("Value "+t+" must be of type "+u.type);n[t]=i}}return n}(e,{url:{required:!0,type:"string"},email:{required:!0,type:"string"},onMessage:{required:!0,type:"function"},button:{required:!1,type:"boolean",default:!0},color:{required:!1,type:"string",default:"#2f81c6"},onOpen:{required:!1,type:"function",default:function(){}},onClose:{required:!1,type:"function",default:function(){}}}),o.url=e.url,o.email=e.email,o.button=e.button,o.color=e.color,o.onMessage=e.onMessage,o.onOpen=e.onOpen,o.onClose=e.onClose,o.socket=new WebSocket(o.url),o.isOpen=!1,o.shouldSend=!1,o.setupSocket(),o.button&&(o.buttonId="unlock-button",o.onclick=o.submit.bind(o),o.buildButton())}function i(e,o){e=e.slice(1);var t=30;o||(t*=-1);var n=parseInt(e,16);return"#"+u((n>>16)+t)+u((n>>8&255)+t)+u((255&n)+t)}function u(e){255<e&&(e=255),e<0&&(e=0);var o=e.toString(16);return 1===o.length&&(o="0"+o),o}e.prototype.unlock=function(){this.socket.send(JSON.stringify({type:"unlock",email:this.getEmail()}))},e.prototype.setupSocket=function(){var e=this;e.socket.onopen=function(){e.onOpen(),e.isOpen=!0,e.shouldSend&&(e.unlock(),e.shouldSend=!1)},e.socket.onclose=function(){e.onClose(),e.socket=void 0,e.isOpen=!1},e.socket.onmessage=function(o){var t;try{t=JSON.parse(o.data)}catch(e){t=o}e.button&&e.enableButton(),e.onMessage(t)}},e.prototype.getEmail=function(){return document.getElementById(this.email).value},e.prototype.submit=function(){var e=this;e.isOpen?(e.disableButton(),e.unlock()):e.shouldSend=!0},e.prototype.enableButton=function(){var e=this;if(e.button){var o=document.getElementById(e.buttonId);o.removeEventListener("click",e.onclick),o.addEventListener("click",e.onclick),o.classList.remove("unlock-disabled"),o.classList.add("unlock-enabled")}},e.prototype.disableButton=function(){var e=this;if(e.button){var o=document.getElementById(e.buttonId);o.removeEventListener("click",e.onclick),o.classList.remove("unlock-enabled"),o.classList.add("unlock-disabled")}},e.prototype.buildButton=function(){var e=this,o=document.getElementById(e.buttonId);o.classList.add("unlock-enabled");o.innerHTML='<img id="unlock-logo" src="https://www.unlock-auth.com/images/unlock-logo-text.svg"><span id="unlock-cover"></span><div id="unlock-spinner"><div class="unlock-dot" id="unlock-dot-one"></div><div class="unlock-dot" id="unlock-dot-two"></div><div class="unlock-dot" id="unlock-dot-three"></div></div>',e.addColor(),e.enableButton()},e.prototype.addColor=function(){var e=this,o=e.color,t=i(e.color,!0),n=i(e.color,!1),u=document.styleSheets[0];u.insertRule("#unlock-button {background-color: "+o+"}",u.cssRules.length),u.insertRule("#unlock-button.unlock-enabled:hover {background-color: "+t+"}",u.cssRules.length),u.insertRule("#unlock-button.unlock-enabled:active {background-color: "+n+"}",u.cssRules.length)},window.Unlock=e}();